<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extended Fasting Tracker - Sam</title>
    <style>
        :root {
            --color-primary: #208091;
            --color-primary-hover: #1a6876;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #1a1a1a;
            --color-text-secondary: #666;
            --color-border: #e0e0e0;
            --color-success: #4caf50;
            --color-warning: #ff9800;
            --color-danger: #f44336;
            --color-info: #2196f3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            padding: 16px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid var(--color-primary);
        }

        h1 {
            font-size: 28px;
            margin-bottom: 8px;
            color: var(--color-primary);
        }

        .user-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 12px;
            font-size: 14px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            color: var(--color-text-secondary);
            font-weight: 500;
        }

        .info-value {
            font-weight: 600;
            font-size: 16px;
            color: var(--color-text);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid var(--color-border);
        }

        .card h2 {
            font-size: 18px;
            margin-bottom: 16px;
            color: var(--color-text);
            border-bottom: 2px solid var(--color-primary);
            padding-bottom: 10px;
        }

        .metrics-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
        }

        .metric-label {
            color: var(--color-text-secondary);
            font-weight: 500;
        }

        .metric-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-primary);
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 14px;
            color: var(--color-text);
        }

        input[type="number"],
        input[type="text"],
        input[type="time"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(32, 128, 145, 0.1);
        }

        .hunger-slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .hunger-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-primary);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .hunger-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-primary);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .hunger-value {
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--color-primary);
            margin-top: 8px;
        }

        .hunger-description {
            text-align: center;
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-top: 4px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
            box-shadow: 0 4px 8px rgba(32, 128, 145, 0.2);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: var(--color-text);
            margin-top: 8px;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .log-entry {
            background: #f9f9f9;
            padding: 14px;
            border-radius: 6px;
            margin-bottom: 12px;
            border-left: 3px solid var(--color-primary);
        }

        .log-time {
            font-weight: 600;
            color: var(--color-primary);
            font-size: 14px;
        }

        .log-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 8px;
            font-size: 13px;
        }

        .log-detail-item {
            display: flex;
            justify-content: space-between;
        }

        .log-label {
            color: var(--color-text-secondary);
            font-weight: 500;
        }

        .log-value {
            font-weight: 600;
            color: var(--color-text);
        }

        .log-craving {
            margin-top: 10px;
            padding: 8px;
            background: #fff3e0;
            border-radius: 4px;
            font-size: 13px;
            color: #e65100;
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-success), var(--color-info));
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .badge-active {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .badge-peak {
            background: #ffe0b2;
            color: #e65100;
        }

        .badge-keto {
            background: #bbdefb;
            color: #1565c0;
        }

        .safety-note {
            background: #fff3e0;
            border-left: 4px solid var(--color-warning);
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 13px;
            line-height: 1.5;
        }

        .safety-note strong {
            color: #e65100;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            border-bottom: 2px solid var(--color-border);
        }

        .tab-btn {
            padding: 10px 16px;
            background: none;
            border: none;
            color: var(--color-text-secondary);
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            width: auto;
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .two-col {
                grid-template-columns: 1fr;
            }

            .log-details {
                grid-template-columns: 1fr;
            }

            .user-info {
                flex-direction: column;
                gap: 8px;
            }

            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚è±Ô∏è Extended Fasting Tracker</h1>
            <div class="user-info">
                <div class="info-item">
                    <span class="info-label">Name</span>
                    <span class="info-value">Sam</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Stats</span>
                    <span class="info-value">94 kg | 161 cm | 40M</span>
                </div>
                <div class="info-item">
                    <span class="info-label">BMI</span>
                    <span class="info-value">36.3 (Obese)</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Fasting Start</span>
                    <span class="info-value">14-Dec 21:30 IST</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Target Duration</span>
                    <span class="info-value">72 hours</span>
                </div>
            </div>
        </header>

        <div class="safety-note">
            <strong>‚ö†Ô∏è Safety Reminder:</strong> You are prediabetic. Stop immediately if you experience chest pain, severe dizziness, fainting, confusion, or palpitations. Keep hydration and salt intake steady. Consult your doctor if unsure.
        </div>

        <!-- VINTAGE SPEEDOMETER CARD -->
        <div class="card" style="margin-bottom: 20px;">
            <h2>üéØ Fasting Stage Speedometer</h2>
            <div style="display: flex; justify-content: center; margin: 20px 0;">
                <svg id="speedometer" viewBox="0 0 360 400" style="width: 100%; max-width: 400px; height: auto;" xmlns="http://www.w3.org/2000/svg">
                    <!-- Background dial -->
                    <defs>
                        <radialGradient id="dialGrad" cx="50%" cy="40%">
                            <stop offset="0%" style="stop-color:#FEFBF7;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#E8DCC8;stop-opacity:1" />
                        </radialGradient>
                        <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
                        </filter>
                        <filter id="innerShadow">
                            <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="coloredBlur"/>
                            <feFlood in="coloredBlur" flood-color="#333" flood-opacity="0.3" result="offsetblur"/>
                            <feComponentTransfer in="offsetblur" result="offsetblur">
                                <feFuncA type="linear" slope="0.5"/>
                            </feComponentTransfer>
                        </filter>
                        <filter id="gloss">
                            <feGaussianBlur in="SourceGraphic" stdDeviation="3"/>
                        </filter>
                    </defs>

                    <!-- Outer rim (brass) -->
                    <circle cx="180" cy="160" r="155" fill="#D4AF37" filter="url(#shadow)"/>
                    <circle cx="180" cy="160" r="150" fill="#C9A961" stroke="#8B7521" stroke-width="2"/>
                    
                    <!-- Dial face -->
                    <circle cx="180" cy="160" r="145" fill="url(#dialGrad)" filter="url(#innerShadow)"/>

                    <!-- Color zones (fasting stages) -->
                    <!-- 0-16h: Green -->
                    <path d="M 180,160 L 180,20 A 140,140 0 0,1 277.5,47.5 Z" fill="#4CAF50" opacity="0.8"/>
                    <!-- 16-24h: Yellow -->
                    <path d="M 180,160 L 277.5,47.5 A 140,140 0 0,1 320,160 Z" fill="#FFC107" opacity="0.8"/>
                    <!-- 24-36h: Orange -->
                    <path d="M 180,160 L 320,160 A 140,140 0 0,1 277.5,272.5 Z" fill="#FF9800" opacity="0.8"/>
                    <!-- 36-48h: Light Blue -->
                    <path d="M 180,160 L 277.5,272.5 A 140,140 0 0,1 82.5,272.5 Z" fill="#87CEEB" opacity="0.8"/>
                    <!-- 48-72h: Dark Blue -->
                    <path d="M 180,160 L 82.5,272.5 A 140,140 0 0,1 180,20 Z" fill="#1E90FF" opacity="0.8"/>

                    <!-- Hour markers and numbers -->
                    <g id="markers">
                        <!-- 0h (12 o'clock position) -->
                        <line x1="180" y1="25" x2="180" y2="45" stroke="#333" stroke-width="3"/>
                        <text x="180" y="15" text-anchor="middle" font-size="12" font-weight="bold">0</text>
                        
                        <!-- 16h -->
                        <line x1="277.5" y1="47.5" x2="295" y2="65" stroke="#333" stroke-width="2.5"/>
                        <text x="305" y="60" font-size="11" font-weight="bold">16h</text>
                        
                        <!-- 24h -->
                        <line x1="320" y1="160" x2="340" y2="160" stroke="#333" stroke-width="2.5"/>
                        <text x="348" y="165" font-size="11" font-weight="bold">24h</text>
                        
                        <!-- 36h -->
                        <line x1="277.5" y1="272.5" x2="295" y2="255" stroke="#333" stroke-width="2.5"/>
                        <text x="305" y="280" font-size="11" font-weight="bold">36h</text>
                        
                        <!-- 48h -->
                        <line x1="82.5" y1="272.5" x2="65" y2="255" stroke="#333" stroke-width="2.5"/>
                        <text x="40" y="280" font-size="11" font-weight="bold">48h</text>
                        
                        <!-- 72h (back to top) -->
                        <line x1="82.5" y1="47.5" x2="65" y2="65" stroke="#333" stroke-width="2.5"/>
                        <text x="40" y="60" font-size="11" font-weight="bold">72h</text>

                        <!-- Minor hour ticks -->
                        <line x1="180" y1="28" x2="180" y2="38" stroke="#666" stroke-width="1" opacity="0.5"/>
                        <line x1="243" y1="34" x2="235" y2="42" stroke="#666" stroke-width="1" opacity="0.5"/>
                        <line x1="295" y1="70" x2="287" y2="78" stroke="#666" stroke-width="1" opacity="0.5"/>
                        <line x1="330" y1="125" x2="322" y2="125" stroke="#666" stroke-width="1" opacity="0.5"/>
                    </g>

                    <!-- Inner hunger ring (color based on hunger level) -->
                    <circle cx="180" cy="160" r="95" fill="none" stroke="#FF6B6B" stroke-width="12" opacity="0.7"/>
                    <text x="180" y="155" text-anchor="middle" font-size="14" font-weight="bold" fill="#333">Hunger</text>
                    <text x="180" y="172" text-anchor="middle" font-size="18" font-weight="bold" fill="#FF6B6B" id="hungerDisplay">2/5</text>

                    <!-- Needle (red, pointing to ~13.75 hours = ~69 degrees) -->
                    <g id="needle" transform="rotate(69 180 160)" style="transition: transform 0.5s ease;">
                        <!-- Needle shaft -->
                        <rect x="176" y="50" width="8" height="115" fill="#8B0000" rx="2"/>
                        <!-- Needle tip -->
                        <polygon points="180,45 177,55 183,55" fill="#8B0000"/>
                    </g>

                    <!-- Center hub (brass) -->
                    <circle cx="180" cy="160" r="14" fill="#D4AF37" stroke="#8B7521" stroke-width="1.5"/>
                    <circle cx="180" cy="160" r="10" fill="#E6D5B8"/>

                    <!-- Glass gloss effect (subtle) -->
                    <ellipse cx="140" cy="110" rx="70" ry="50" fill="white" opacity="0.1" filter="url(#gloss)"/>

                    <!-- Phase label at bottom -->
                    <text x="180" y="350" text-anchor="middle" font-size="14" font-weight="bold" fill="#333" id="phaseLabel">GLYCOGEN DEPLETION</text>
                    
                    <!-- Hours display -->
                    <text x="180" y="320" text-anchor="middle" font-size="16" font-weight="bold" fill="#208091" id="hoursDisplay">13.75 / 72 HOURS</text>
                    
                    <!-- Clarity display -->
                    <text x="180" y="375" text-anchor="middle" font-size="12" fill="#666" id="clarityDisplay">Clarity: 4/5 | Energy: ‚ö°‚ö°‚ö°</text>
                </svg>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>‚è≥ Current Fasting Status</h2>
                <div class="metrics-row">
                    <span class="metric-label">Fasting Hour</span>
                    <span class="metric-value" id="fastingHour">13h 44m</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Time Remaining</span>
                    <span class="metric-value" id="timeRemaining">58h 16m</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Progress</span>
                    <span class="metric-value" id="progressPercent">19%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 19%;"></div>
                </div>
                <div id="phaseStatus"></div>
            </div>

            <div class="card">
                <h2>üíß Hydration & Electrolytes</h2>
                <!-- Fasting Stage Gauge -->
                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 14px; margin-bottom: 12px; color: var(--color-text-secondary);">üéØ Fasting Stage Gauge</h3>
                    <div style="display: flex; height: 30px; border-radius: 4px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="flex: 1; background: #4CAF50; position: relative;" title="16h: Glycogen"><span style="position: absolute; left: 5px; top: 5px; font-size: 10px; color: white; font-weight: bold;">16h</span></div>
                        <div style="flex: 1; background: #FFC107;position: relative;" title="24h: Fat Burn"><span style="position: absolute; left: 5px; top: 5px; font-size: 10px; color: #333; font-weight: bold;">24h</span></div>
                        <div style="flex: 1; background: #FF9800; position: relative;" title="36h: Autophagy"><span style="position: absolute; left: 5px; top: 5px; font-size: 10px; color: white; font-weight: bold;">36h</span></div>
                        <div style="flex: 1; background: #87CEEB; position: relative;" title="48h: Ketosis"><span style="position: absolute; left: 5px; top: 5px; font-size: 10px; color: #333; font-weight: bold;">48h</span></div>
                        <div style="flex: 1; background: #1E90FF; position: relative;" title="72h: Survival"><span style="position: absolute; left: 5px; top: 5px; font-size: 10px; color: white; font-weight: bold;">72h</span></div>
                    </div>
                    <div style="margin-top: 8px; font-size: 12px; color: var(--color-text-secondary); text-align: center;">
                        You are in: <span id="stageLabel" style="font-weight: 600; color: var(--color-primary);">Stage 1 - Glycogen Depletion</span>
                    </div>
                </div>

                <div class="metrics-row">
                    <span class="metric-label">Water Intake (L)</span>
                    <span class="metric-value" id="waterIntake">0.0</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Salt Intake (times)</span>
                    <span class="metric-value" id="saltIntake">0</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Snacks/Beverages</span>
                    <span class="metric-value" id="snackCount">0</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Target Water/Day</span>
                    <span class="metric-value">2-3 L</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Dizziness Risk</span>
                    <span class="metric-value" id="dizzinessRisk">Low</span>
                </div>
            </div>

            <div class="card">
                <h2>‚öñÔ∏è Weight & Goal Progress</h2>
                <div class="metrics-row">
                    <span class="metric-label">Current Weight</span>
                    <span class="metric-value">94 kg</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Goal (7kg loss)</span>
                    <span class="metric-value">87 kg</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Long-term (10%)</span>
                    <span class="metric-value">84.6 kg</span>
                </div>
                <p style="font-size: 12px; color: var(--color-text-secondary); margin-top: 12px;">Expected loss during 72h fast: 0.5-1.5 kg (mostly water & glycogen)</p>
            </div>

            <div class="card">
                <h2>üî• Calorie & Deficit Tracker</h2>
                <div class="metrics-row">
                    <span class="metric-label">Basal Metabolic Rate (BMR)</span>
                    <span class="metric-value" id="bmrValue">2,100 kcal</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Daily Maintenance (sedentary)</span>
                    <span class="metric-value">2,520 kcal</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Fast Day Intake</span>
                    <span class="metric-value" id="fastDayIntake">0 kcal</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">72h Fast Deficit</span>
                    <span class="metric-value" id="fastDeficit">7,560 kcal</span>
                </div>
                <p style="font-size: 12px; color: var(--color-text-secondary); margin-top: 12px;">Est. fat loss: ~0.8-1.0 kg (72h deficit @ ~1,050 kcal/day)</p>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('log')">üìù Log Entry</button>
            <button class="tab-btn" onclick="switchTab('exercise')">üí™ Exercise</button>
            <button class="tab-btn" onclick="switchTab('measurements')">üìè Measurements</button>
            <button class="tab-btn" onclick="switchTab('history')">üìä History</button>
            <button class="tab-btn" onclick="switchTab('data')">üíæ Data</button>
            <button class="tab-btn" onclick="switchTab('guidelines')">üìñ Guidelines</button>
        </div>

        <!-- LOG ENTRY TAB -->
        <div id="log" class="tab-content active">
            <div class="card">
                <h2>Add Log Entry</h2>
                
                <div class="form-group">
                    <label>Current Time (IST)</label>
                    <input type="time" id="logTime" value="">
                </div>

                <div class="form-group">
                    <label>Hunger Index (1 = No hunger, 5 = Intense)</label>
                    <input type="range" id="hungerSlider" class="hunger-slider" min="1" max="5" step="0.5" value="2" oninput="updateHunger()">
                    <div class="hunger-value" id="hungerValue">2</div>
                    <div class="hunger-description" id="hungerDescription">Manageable</div>
                </div>

                <div class="form-group">
                    <label>Water Intake This Entry (liters)</label>
                    <input type="number" id="waterInput" min="0" step="0.1" placeholder="e.g., 0.5">
                </div>

                <div class="form-group">
                    <label>Salt Intake This Entry</label>
                    <select id="saltInput">
                        <option value="none">None</option>
                        <option value="pinch">Pinch of salt</option>
                        <option value="lemon">Lemon + salt water</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Mental State / Mood (Clarity)</label>
                    <input type="range" id="claritySlider" class="hunger-slider" min="1" max="5" step="0.5" value="4" oninput="updateClarity()">
                    <div class="clarity-value" id="clarityValue" style="text-align: center; font-size: 18px; font-weight: 700; color: #4CAF50; margin-top: 8px;">4 - Good</div>
                    <div style="text-align: center; font-size: 12px; color: var(--color-text-secondary); margin-top: 4px;" id="clarityDescription">Clear thinking</div>
                </div>

                <div class="form-group">
                    <label>Any Snacks / Minor Drinks Consumed?</label>
                    <select id="snackSelect" onchange="addSnackConsumption()">
                        <option value="">-- None --</option>
                        <option value="black_tea">Black Tea / Coffee</option>
                        <option value="lemon_water">Lemon Water</option>
                        <option value="salt_pinch">Salt + Water</option>
                        <option value="electrolyte">Electrolyte Mix (0 cal)</option>
                        <option value="broth">Vegetable Broth (small)</option>
                        <option value="juice">Fruit Juice (broke fast)</option>
                        <option value="milk">Milk / Chai (broke fast)</option>
                        <option value="food_small">Small Food Item (broke fast)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Any Cravings or Foods Desired?</label>
                    <textarea id="cravingInput" rows="2" placeholder="e.g., samosa, chai, sweet, etc."></textarea>
                </div>

                <div class="form-group">
                    <label>Other Symptoms/Notes</label>
                    <textarea id="notesInput" rows="2" placeholder="e.g., headache, energy level, mood, etc."></textarea>
                </div>

                <button class="btn-primary" onclick="addLogEntry()">‚úÖ Save Log Entry</button>
            </div>
        </div>

        <!-- EXERCISE TAB -->
        <div id="exercise" class="tab-content">
            <div class="card">
                <h2>üí™ Exercise & Activity Tracker</h2>
                
                <div style="background: #f0f0f0; padding: 12px; border-radius: 4px; margin-bottom: 16px;">
                    <h3 style="font-size: 14px; margin-bottom: 8px; color: var(--color-text);">Exercise Guidelines by Fasting Phase</h3>
                    <ul style="margin: 0 0 0 20px; font-size: 13px; line-height: 1.5; color: var(--color-text-secondary);">
                        <li><strong>Hours 0-16:</strong> Light walk (20-30 min), gentle stretching. Calorie burn: ~100-150 kcal</li>
                        <li><strong>Hours 16-36:</strong> Very light activity or rest. AVOID heavy exercise. Burn: ~50-80 kcal</li>
                        <li><strong>Hours 36-72:</strong> Light walk if energy permits (15-25 min). Calorie burn: ~80-120 kcal</li>
                    </ul>
                </div>

                <div class="form-group">
                    <label>Exercise Type</label>
                    <select id="exerciseType">
                        <option value="">-- Select Activity --</option>
                        <option value="walking_light">Light Walking (3 km/h)</option>
                        <option value="walking_brisk">Brisk Walking (5 km/h)</option>
                        <option value="yoga">Yoga / Stretching</option>
                        <option value="breathing">Breathing Exercises (Pranayama)</option>
                        <option value="cycling_light">Light Cycling</option>
                        <option value="swimming">Swimming (light)</option>
                        <option value="resistance">Resistance / Weights</option>
                        <option value="cardio">Cardio (Running/HIIT)</option>
                        <option value="rest">Rest Day / No Activity</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <input type="number" id="exerciseDuration" min="0" step="5" placeholder="e.g., 30">
                </div>

                <div class="form-group">
                    <label>Intensity (1 = Very Light, 5 = Very Hard)</label>
                    <input type="range" id="exerciseIntensity" class="hunger-slider" min="1" max="5" step="0.5" value="2" oninput="updateIntensity()">
                    <div style="text-align: center; font-size: 18px; font-weight: 700; color: var(--color-primary); margin-top: 8px;" id="intensityValue">2</div>
                    <div style="text-align: center; font-size: 12px; color: var(--color-text-secondary); margin-top: 4px;" id="intensityDescription">Light</div>
                </div>

                <div class="form-group">
                    <label>Energy Level During / After (1 = Very Tired, 5 = Very Energetic)</label>
                    <input type="range" id="energyLevel" class="hunger-slider" min="1" max="5" step="0.5" value="3" oninput="updateEnergy()">
                    <div style="text-align: center; font-size: 18px; font-weight: 700; color: var(--color-success); margin-top: 8px;" id="energyValue">3</div>
                </div>

                <div class="form-group">
                    <label>Estimated Calories Burned (kcal) - or auto-calc</label>
                    <input type="number" id="caloriesBurned" min="0" step="10" placeholder="auto-calculated">
                </div>

                <div class="form-group">
                    <label>Notes / How You Felt</label>
                    <textarea id="exerciseNotes" rows="2" placeholder="e.g., felt strong, slight dizziness, good energy, etc."></textarea>
                </div>

                <button class="btn-primary" onclick="addExerciseEntry()">‚úÖ Log Exercise</button>

                <h3 style="margin-top: 20px; margin-bottom: 12px; color: var(--color-primary);">Today's Activity Summary</h3>
                <div class="metrics-row">
                    <span class="metric-label">Total Exercise Time</span>
                    <span class="metric-value" id="totalExerciseTime">0 min</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Total Calories Burned (Exercise)</span>
                    <span class="metric-value" id="totalCaloriesBurned">0 kcal</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Total Daily Deficit</span>
                    <span class="metric-value" id="totalDailyDeficit" style="color: #4CAF50;">~2,520 kcal</span>
                </div>
                <div id="exerciseHistory" style="margin-top: 16px;"></div>
            </div>
        </div>

        <!-- MEASUREMENTS TAB -->
        <div id="measurements" class="tab-content">
            <div class="card">
                <h2>üìè Body Measurements Tracker</h2>
                
                <div style="background: #e3f2fd; padding: 12px; border-radius: 4px; margin-bottom: 16px;">
                    <h3 style="font-size: 13px; margin-bottom: 8px; color: #1565c0;">üìå Measurement Schedule</h3>
                    <p style="font-size: 12px; color: #0d47a1; margin: 0;">Log measurements on <strong>Day 1 or Day 2</strong> of your fast as baseline. Then measure again whenever you want to track progress.</p>
                </div>

                <div class="form-group">
                    <label>Measurement Date</label>
                    <input type="date" id="measurementDate" value="">
                </div>

                <div class="form-group">
                    <label>üìä Select Body Parts to Measure</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="checkbox" id="measure_weight" value="weight"> <label for="measure_weight" style="margin: 0; font-size: 13px;">Weight (kg)</label>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="checkbox" id="measure_chest" value="chest"> <label for="measure_chest" style="margin: 0; font-size: 13px;">Chest (cm)</label>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="checkbox" id="measure_waist" value="waist"> <label for="measure_waist" style="margin: 0; font-size: 13px;">Waist (cm)</label>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="checkbox" id="measure_hips" value="hips"> <label for="measure_hips" style="margin: 0; font-size: 13px;">Hips (cm)</label>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="checkbox" id="measure_thigh" value="thigh"> <label for="measure_thigh" style="margin: 0; font-size: 13px;">Thigh (cm)</label>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="checkbox" id="measure_arm" value="arm"> <label for="measure_arm" style="margin: 0; font-size: 13px;">Arm (cm)</label>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="checkbox" id="measure_neck" value="neck"> <label for="measure_neck" style="margin: 0; font-size: 13px;">Neck (cm)</label>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="checkbox" id="measure_forearm" value="forearm"> <label for="measure_forearm" style="margin: 0; font-size: 13px;">Forearm (cm)</label>
                        </div>
                    </div>
                </div>

                <div id="measurementInputs"></div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="measurementNotes" rows="2" placeholder="e.g., measured after workout, fasted state, etc."></textarea>
                </div>

                <button class="btn-primary" onclick="addMeasurement()">‚úÖ Save Measurements</button>

                <h3 style="margin-top: 20px; margin-bottom: 12px; color: var(--color-primary);">üìä Measurement History</h3>
                <div id="measurementHistory"></div>
                <p id="noMeasurements" style="text-align: center; color: var(--color-text-secondary); padding: 20px;">No measurements yet. Start on Day 1 or Day 2!</p>
            </div>
        </div>

        <!-- HISTORY TAB -->
        <div id="history" class="tab-content">
            <div class="card">
                <h2>Fasting Log History</h2>
                <div id="logHistory"></div>
                <p id="noLogs" style="text-align: center; color: var(--color-text-secondary); padding: 20px;">No entries yet. Start logging!</p>
            </div>
        </div>

        <!-- DATA MANAGEMENT TAB -->
        <div id="data" class="tab-content">
            <div class="card">
                <h2>üíæ Data Management & Export</h2>
                
                <div style="background: #e8f5e9; padding: 12px; border-radius: 4px; margin-bottom: 16px; border-left: 4px solid #4CAF50;">
                    <h3 style="font-size: 14px; margin-bottom: 8px; color: #2e7d32;">üì§ Export Your Data</h3>
                    <p style="font-size: 12px; color: #1b5e20; margin: 0;">Export all your fasting logs, measurements, and exercise data as CSV or send via email.</p>
                </div>

                <div class="two-col" style="margin-bottom: 20px;">
                    <button class="btn-primary" onclick="exportToCSV()">üì• Download as CSV</button>
                    <button class="btn-primary" onclick="exportToEmail()">üìß Export via Email</button>
                </div>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-border);">

                <div style="background: #e3f2fd; padding: 12px; border-radius: 4px; margin-bottom: 16px; border-left: 4px solid #2196f3;">
                    <h3 style="font-size: 14px; margin-bottom: 8px; color: #1565c0;">üì• Import Previous Data</h3>
                    <p style="font-size: 12px; color: #0d47a1; margin: 0;">Upload a previously exported CSV file to restore your fasting history and measurements.</p>
                </div>

                <div class="form-group">
                    <label>Select CSV File to Import</label>
                    <input type="file" id="importFile" accept=".csv" style="cursor: pointer;">
                </div>

                <button class="btn-primary" onclick="importFromCSV()">‚úÖ Import Data</button>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-border);">

                <h3 style="margin-top: 20px; margin-bottom: 16px; color: var(--color-primary);">üìä Weight Progress Chart</h3>
                
                <div class="form-group">
                    <label>Select Date Range</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label style="font-size: 12px;">From Date</label>
                            <input type="date" id="chartStartDate">
                        </div>
                        <div>
                            <label style="font-size: 12px;">To Date</label>
                            <input type="date" id="chartEndDate">
                        </div>
                    </div>
                </div>

                <button class="btn-primary" onclick="generateWeightChart()" style="margin-bottom: 20px;">üîÑ Generate Chart</button>

                <div id="weightChartContainer" style="background: white; padding: 20px; border-radius: 8px; border: 1px solid var(--color-border); display: none;">
                    <canvas id="weightChart" style="max-height: 400px;"></canvas>
                </div>
                <p id="noChartData" style="text-align: center; color: var(--color-text-secondary); padding: 20px;">No weight measurements in selected range. Add measurements to see chart.</p>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-border);">

                <h3 style="margin-top: 20px; margin-bottom: 12px; color: var(--color-primary);">üîî Notification Settings</h3>

                <div style="background: #fff3e0; padding: 12px; border-radius: 4px; margin-bottom: 16px;">
                    <p style="font-size: 12px; color: #e65100; margin: 0;">üí° <strong>Tip:</strong> Enable browser notifications for hydration & salt reminders during your fast.</p>
                </div>

                <div class="form-group">
                    <label>Reminder Frequency</label>
                    <select id="reminderFrequency">
                        <option value="30">Every 30 minutes</option>
                        <option value="60" selected>Every hour</option>
                        <option value="120">Every 2 hours</option>
                        <option value="custom">Custom time</option>
                    </select>
                </div>

                <div class="form-group" id="customTimeGroup" style="display: none;">
                    <label>Custom Reminder Time (minutes)</label>
                    <input type="number" id="customReminderTime" min="5" step="5" placeholder="e.g., 45">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px;">
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="checkbox" id="reminderWater" checked> 
                        <label for="reminderWater" style="margin: 0; font-size: 13px;">Water Reminder üíß</label>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="checkbox" id="reminderSalt" checked> 
                        <label for="reminderSalt" style="margin: 0; font-size: 13px;">Salt Reminder üßÇ</label>
                    </div>
                </div>

                <button class="btn-primary" onclick="enableNotifications()">üîî Enable Notifications</button>
                <button class="btn-secondary" onclick="disableNotifications()">üîá Disable Notifications</button>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-border);">

                <h3 style="margin-top: 20px; margin-bottom: 12px; color: var(--color-primary);">‚öôÔ∏è App Info</h3>
                <div class="metrics-row">
                    <span class="metric-label">App Name</span>
                    <span class="metric-value" style="font-size: 16px;">FastTrack Pro</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Version</span>
                    <span class="metric-value" style="font-size: 16px;">1.0.0</span>
                </div>
                <div class="metrics-row">
                    <span class="metric-label">Data Stored</span>
                    <span class="metric-value" id="dataSize" style="font-size: 16px;">Local Browser</span>
                </div>
            </div>
        </div>

        <!-- GUIDELINES TAB -->
        <div id="guidelines" class="tab-content">
            <div class="card">
                <h2>üìã 72-Hour Fasting Guidelines</h2>
                
                <h3 style="margin-top: 16px; margin-bottom: 10px; color: var(--color-primary);">Phase 1: Hours 0-12 (Glycogen Depletion)</h3>
                <ul style="margin: 0 0 16px 20px; line-height: 1.6;">
                    <li>Hunger: Low to moderate. Insulin dropping.</li>
                    <li>Water: Sip regularly. Salt intake: minimal unless headache.</li>
                    <li>Activity: Light walking OK. No heavy exercise.</li>
                </ul>

                <h3 style="margin-top: 16px; margin-bottom: 10px; color: var(--color-warning);">Phase 2: Hours 12-36 (Peak Hunger & Ketosis Start)</h3>
                <ul style="margin: 0 0 16px 20px; line-height: 1.6;">
                    <li>Hunger: Peak around hours 20-28. Most difficult phase.</li>
                    <li>Strategies: Drink lemon-salt water, do light breathing exercises, occupy mind.</li>
                    <li>Water: Increase to 2-3 L/day. Salt: pinch if light-headed.</li>
                </ul>

                <h3 style="margin-top: 16px; margin-bottom: 10px; color: var(--color-success);">Phase 3: Hours 36-72 (Deep Ketosis, Fat Burning)</h3>
                <ul style="margin: 0 0 16px 20px; line-height: 1.6;">
                    <li>Hunger: Drops significantly. Body in fat-burning mode.</li>
                    <li>Energy: May spike or remain low. Listen to your body.</li>
                    <li>Focus: Hydration and electrolytes are key. Prepare refeed meals mentally.</li>
                </ul>

                <h3 style="margin-top: 16px; margin-bottom: 10px; color: var(--color-danger);">üö® STOP the fast immediately if:</h3>
                <ul style="margin: 0 0 16px 20px; line-height: 1.6;">
                    <li>Chest pain, severe dizziness, or fainting</li>
                    <li>Confusion, difficulty thinking, or severe fatigue</li>
                    <li>Heart palpitations or racing heartbeat</li>
                    <li>Severe headache not relieved by salt/water</li>
                </ul>

                <h3 style="margin-top: 16px; margin-bottom: 10px; color: var(--color-text);">‚úÖ Breaking the 72-Hour Fast (Vegetarian Refeed)</h3>
                <ul style="margin: 0 0 16px 20px; line-height: 1.6;">
                    <li><strong>Hour 72-75:</strong> Thin vegetable soup or diluted dal. Chew slowly.</li>
                    <li><strong>Hour 75-24h after:</strong> Add steamed vegetables, soft khichdi, curd.</li>
                    <li><strong>Day 2-3 after:</strong> Gradually add nuts, whole grains, normal meals.</li>
                    <li><strong>Key:</strong> Eat slowly. Stop at "just full", not bloated.</li>
                </ul>

                <h3 style="margin-top: 16px; margin-bottom: 10px; color: var(--color-text);">üí™ Exercise During Fast</h3>
                <ul style="margin: 0 0 16px 20px; line-height: 1.6;">
                    <li>Hours 0-24: Light walking only (30-45 min). Stretch gently.</li>
                    <li>Hours 24-48: Continue light activity or rest.</li>
                    <li>Hours 48-72: Light walking if energy permits. Stop if dizzy.</li>
                    <li>Avoid: Heavy lifting, intense cardio, gym during fast.</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Initialize current time
        const now = new Date();
        document.getElementById('logTime').value = now.toTimeString().slice(0, 5);

        // Fasting start time: 14-Dec-25 21:30 IST
        const fastStart = new Date('2025-12-14T21:30:00+05:30');
        const targetDuration = 72 * 60; // 72 hours in minutes
        const fastEnd = new Date(fastStart.getTime() + targetDuration * 60000);

        // Log entries storage
        let logEntries = [];
        let snackLog = [];
        let exerciseEntries = [];
        let measurementEntries = [];

        // Measurement types
        const bodyParts = {
            weight: { label: 'Weight', unit: 'kg', icon: '‚öñÔ∏è' },
            chest: { label: 'Chest', unit: 'cm', icon: 'üìå' },
            waist: { label: 'Waist', unit: 'cm', icon: 'üìè' },
            hips: { label: 'Hips', unit: 'cm', icon: 'üìè' },
            thigh: { label: 'Thigh', unit: 'cm', icon: 'üìè' },
            arm: { label: 'Arm', unit: 'cm', icon: 'üí™' },
            neck: { label: 'Neck', unit: 'cm', icon: 'üìè' },
            forearm: { label: 'Forearm', unit: 'cm', icon: 'üí™' }
        };

        // BMR calculation (Mifflin-St Jeor formula) - Sam: 40M, 94kg, 161cm
        const bmr = Math.round(10 * 94 + 6.25 * 161 - 5 * 40 + 5);
        const maintenanceCalories = Math.round(bmr * 1.2); // Sedentary multiplier

        // Exercise calorie burn estimates (kcal per activity per minute for 94kg male)
        const exerciseCalories = {
            walking_light: 4.5,
            walking_brisk: 7.5,
            yoga: 3.5,
            breathing: 1,
            cycling_light: 6,
            swimming: 8,
            resistance: 6,
            cardio: 12,
            rest: 0
        };

        // Fasting stage metadata
        const stageMetadata = [
            { hour: 16, color: '#4CAF50', name: 'Glycogen Depletion', hunger: '1-2', clarity: '4-5', metabolic: 'Glycogenolysis' },
            { hour: 24, color: '#FFC107', name: 'Early Fat Burn (Peak Hunger)', hunger: '3-4', clarity: '3', metabolic: 'Lipolysis' },
            { hour: 36, color: '#FF9800', name: 'Autophagy Peak', hunger: '2-3', clarity: '3-4', metabolic: 'Autophagy Active' },
            { hour: 48, color: '#87CEEB', name: 'Deep Ketosis', hunger: '1-2', clarity: '4-5', metabolic: 'Ketogenesis' },
            { hour: 72, color: '#1E90FF', name: 'Maximum Fat Burn', hunger: '1', clarity: '5', metabolic: 'Survival Mode' }
        ];

        // Get stage based on elapsed hours
        function getStageInfo(hours) {
            let stage = stageMetadata[0];
            for (let s of stageMetadata) {
                if (hours >= s.hour) stage = s;
            }
            return stage;
        }

        // Update fasting time every minute
        function updateFastingTime() {
            const now = new Date();
            const elapsed = (now - fastStart) / (1000 * 60); // in minutes
            const remaining = targetDuration - elapsed;

            const elapsedHours = Math.floor(elapsed / 60);
            const elapsedMins = Math.floor(elapsed % 60);
            const remainingHours = Math.floor(remaining / 60);
            const remainingMins = Math.floor(remaining % 60);

            document.getElementById('fastingHour').textContent = `${elapsedHours}h ${elapsedMins}m`;
            document.getElementById('timeRemaining').textContent = `${remainingHours}h ${remainingMins}m`;

            const progressPercent = (elapsed / targetDuration) * 100;
            document.getElementById('progressPercent').textContent = Math.round(progressPercent) + '%';
            document.getElementById('progressBar').style.width = progressPercent + '%';

            // Determine stage and update label
            const stage = getStageInfo(elapsedHours);
            let phaseBadge = '';
            if (elapsedHours < 16) {
                phaseBadge = 'badge-active';
            } else if (elapsedHours < 36) {
                phaseBadge = 'badge-peak';
            } else {
                phaseBadge = 'badge-keto';
            }
            document.getElementById('phaseStatus').innerHTML = `<div class="status-badge ${phaseBadge}">${stage.name} (Metabolic: ${stage.metabolic})</div>`;
            document.getElementById('stageLabel').textContent = stage.name;

            // Update dizziness risk based on water intake
            const avgWaterPerHour = (parseFloat(document.getElementById('waterIntake').textContent) || 0) / (elapsedHours || 1);
            let dizzinessRisk = 'Low';
            if (avgWaterPerHour < 0.25) {
                dizzinessRisk = 'High - Drink more!';
            } else if (avgWaterPerHour < 0.35) {
                dizzinessRisk = 'Moderate';
            }
            document.getElementById('dizzinessRisk').textContent = dizzinessRisk;
        }

        function updateClarity() {
            const clarity = parseFloat(document.getElementById('claritySlider').value);
            document.getElementById('clarityValue').textContent = clarity;

            let description = '';
            if (clarity >= 4.5) description = '‚úÖ Excellent - Sharp thinking';
            else if (clarity >= 3.5) description = '‚úÖ Good - Clear mind';
            else if (clarity >= 2.5) description = '‚ö†Ô∏è Fair - Slight fog';
            else description = 'üî¥ Low - Brain fog (hydrate & rest)';

            document.getElementById('clarityDescription').textContent = description;
        }

        function updateIntensity() {
            const intensity = parseFloat(document.getElementById('exerciseIntensity').value);
            document.getElementById('intensityValue').textContent = intensity;

            let description = '';
            if (intensity <= 1.5) description = '‚úÖ Very Light - Easy';
            else if (intensity <= 2.5) description = '‚úÖ Light - Manageable';
            else if (intensity <= 3.5) description = '‚ö†Ô∏è Moderate - Breathing elevated';
            else if (intensity <= 4.5) description = 'üî¥ Hard - Heavy breathing';
            else description = 'üî¥üî¥ Very Hard - Maximum effort';

            document.getElementById('intensityDescription').textContent = description;
        }

        function updateEnergy() {
            const energy = parseFloat(document.getElementById('energyLevel').value);
            document.getElementById('energyValue').textContent = energy;
        }

        function addExerciseEntry() {
            const type = document.getElementById('exerciseType').value;
            const duration = parseFloat(document.getElementById('exerciseDuration').value) || 0;
            const intensity = document.getElementById('exerciseIntensity').value;
            const energy = document.getElementById('energyLevel').value;
            let calories = parseFloat(document.getElementById('caloriesBurned').value);
            const notes = document.getElementById('exerciseNotes').value;
            const time = document.getElementById('logTime').value;

            if (!type || duration === 0) {
                alert('Please select exercise type and duration');
                return;
            }

            // Auto-calculate calories if not entered
            if (!calories || calories === 0) {
                const baseCalories = exerciseCalories[type] || 5;
                calories = Math.round(baseCalories * duration * (parseFloat(intensity) / 2.5));
            }

            const entry = {
                type,
                duration,
                intensity,
                energy,
                calories,
                notes,
                time,
                timestamp: new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })
            };

            exerciseEntries.push(entry);

            // Update summaries
            updateExerciseSummary();

            // Clear form
            document.getElementById('exerciseType').value = '';
            document.getElementById('exerciseDuration').value = '';
            document.getElementById('exerciseIntensity').value = 2;
            document.getElementById('energyLevel').value = 3;
            document.getElementById('caloriesBurned').value = '';
            document.getElementById('exerciseNotes').value = '';
            updateIntensity();
            updateEnergy();

            renderExerciseHistory();
            alert('‚úÖ Exercise logged!');
        }

        function updateExerciseSummary() {
            const totalTime = exerciseEntries.reduce((sum, e) => sum + parseFloat(e.duration), 0);
            const totalCalories = exerciseEntries.reduce((sum, e) => sum + e.calories, 0);
            const fastingCalories = 0; // Fasting = 0 intake
            const totalDeficit = maintenanceCalories + totalCalories;

            document.getElementById('totalExerciseTime').textContent = totalTime + ' min';
            document.getElementById('totalCaloriesBurned').textContent = totalCalories + ' kcal';
            document.getElementById('fastDayIntake').textContent = fastingCalories + ' kcal';
            document.getElementById('fastDeficit').textContent = Math.round(maintenanceCalories * 3) + ' kcal'; // 3 days
            document.getElementById('totalDailyDeficit').textContent = '~' + totalDeficit.toLocaleString() + ' kcal';
        }

        function renderExerciseHistory() {
            const historyDiv = document.getElementById('exerciseHistory');
            if (exerciseEntries.length === 0) {
                historyDiv.innerHTML = '<p style="text-align: center; color: var(--color-text-secondary);">No exercises logged yet.</p>';
                return;
            }

            historyDiv.innerHTML = '<h4 style="margin-bottom: 10px; color: var(--color-text);">Recent Activities</h4>' + exerciseEntries.map((entry, idx) => `
                <div class="log-entry">
                    <div class="log-time">Entry #${idx + 1} - ${entry.time} IST</div>
                    <div class="log-details">
                        <div class="log-detail-item">
                            <span class="log-label">Activity</span>
                            <span class="log-value">${entry.type.replace(/_/g, ' ')}</span>
                        </div>
                        <div class="log-detail-item">
                            <span class="log-label">Duration</span>
                            <span class="log-value">${entry.duration} min</span>
                        </div>
                        <div class="log-detail-item">
                            <span class="log-label">Intensity</span>
                            <span class="log-value">${entry.intensity}/5</span>
                        </div>
                        <div class="log-detail-item">
                            <span class="log-label">Calories Burned</span>
                            <span class="log-value" style="color: #FF6B6B;">${entry.calories} kcal</span>
                        </div>
                        <div class="log-detail-item">
                            <span class="log-label">Energy After</span>
                            <span class="log-value" style="color: ${entry.energy >= 4 ? '#4CAF50' : entry.energy >= 3 ? '#FFC107' : '#FF6B6B'};">${entry.energy}/5</span>
                        </div>
                        <div class="log-detail-item">
                            <span class="log-label">Notes</span>
                            <span class="log-value">${entry.notes || '-'}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function addSnackConsumption() {
            const snackType = document.getElementById('snackSelect').value;
            if (!snackType) return;

            const now = new Date();
            const time = now.toTimeString().slice(0, 5);
            const snack = {
                type: snackType,
                time: time,
                label: document.getElementById('snackSelect').options[document.getElementById('snackSelect').selectedIndex].text,
                brokefast: ['juice', 'milk', 'food_small', 'broth'].includes(snackType)
            };

            snackLog.push(snack);
            const count = snackLog.filter(s => !s.brokefast).length;
            document.getElementById('snackCount').textContent = count;
            document.getElementById('snackSelect').value = '';

            // Log this as note entry
            const notesInput = document.getElementById('notesInput');
            notesInput.value += (notesInput.value ? '\n' : '') + `[${time}] Consumed: ${snack.label}${snack.brokefast ? ' (FAST BROKEN)' : ''}`;
        }

        function updateHunger() {
            const hunger = parseFloat(document.getElementById('hungerSlider').value);
            document.getElementById('hungerValue').textContent = hunger;

            let description = '';
            if (hunger <= 1.5) description = '‚úÖ No hunger';
            else if (hunger <= 2.5) description = '‚úÖ Manageable';
            else if (hunger <= 3.5) description = '‚ö†Ô∏è Noticeable (push through)';
            else if (hunger <= 4.5) description = 'üî¥ Strong (drink water/lemon-salt)';
            else description = 'üî¥üî¥ Very strong (breathing exercise)';

            document.getElementById('hungerDescription').textContent = description;
        }

        function addLogEntry() {
            const time = document.getElementById('logTime').value;
            const hunger = document.getElementById('hungerSlider').value;
            const clarity = document.getElementById('claritySlider').value;
            const water = document.getElementById('waterInput').value || '0';
            const salt = document.getElementById('saltInput').value;
            const craving = document.getElementById('cravingInput').value;
            const notes = document.getElementById('notesInput').value;

            if (!time) {
                alert('Please enter the time');
                return;
            }

            const entry = {
                time,
                hunger,
                clarity,
                water,
                salt,
                craving,
                notes,
                timestamp: new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })
            };

            logEntries.push(entry);

            // Update water intake counter
            const totalWater = logEntries.reduce((sum, e) => sum + parseFloat(e.water), 0);
            document.getElementById('waterIntake').textContent = totalWater.toFixed(1);

            // Update salt count
            const saltCount = logEntries.filter(e => e.salt !== 'none').length;
            document.getElementById('saltIntake').textContent = saltCount;

            // Clear form
            document.getElementById('hungerSlider').value = 2;
            document.getElementById('claritySlider').value = 4;
            document.getElementById('waterInput').value = '';
            document.getElementById('saltInput').value = 'none';
            document.getElementById('cravingInput').value = '';
            document.getElementById('notesInput').value = '';
            updateHunger();
            updateClarity();

            // Update display time
            const now = new Date();
            document.getElementById('logTime').value = now.toTimeString().slice(0, 5);

            renderHistory();
            alert('‚úÖ Log entry saved!');
        }

        function renderHistory() {
            const historyDiv = document.getElementById('logHistory');
            const noLogs = document.getElementById('noLogs');

            if (logEntries.length === 0) {
                historyDiv.innerHTML = '';
                noLogs.style.display = 'block';
                return;
            }

            noLogs.style.display = 'none';
            historyDiv.innerHTML = logEntries.map((entry, idx) => `
                <div class="log-entry">
                    <div class="log-time">Entry #${idx + 1} - ${entry.time} IST</div>
                    <div class="log-details">
                        <div class="log-detail-item">
                            <span class="log-label">Hunger</span>
                            <span class="log-value" style="color: ${parseFloat(entry.hunger) <= 2 ? '#4CAF50' : parseFloat(entry.hunger) <= 3 ? '#FFC107' : '#FF6B6B'};">${entry.hunger}/5</span>
                        </div>
                        <div class="log-detail-item">
                            <span class="log-label">Clarity</span>
                            <span class="log-value" style="color: ${parseFloat(entry.clarity) >= 4 ? '#4CAF50' : parseFloat(entry.clarity) >= 3 ? '#FFC107' : '#FF6B6B'};">${entry.clarity}/5</span>
                        </div>
                        <div class="log-detail-item">
                            <span class="log-label">Water (L)</span>
                            <span class="log-value">${entry.water}</span>
                        </div>
                        <div class="log-detail-item">
                            <span class="log-label">Salt</span>
                            <span class="log-value">${entry.salt === 'none' ? 'No' : 'Yes'}</span>
                        </div>
                    </div>
                    ${entry.notes ? `<div class="log-craving" style="background: #f0f0f0; color: #333;">üìù Notes: ${entry.notes}</div>` : ''}
                    ${entry.craving ? `<div class="log-craving">üçΩÔ∏è Craving: ${entry.craving}</div>` : ''}
                </div>
            `).join('');
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Speedometer update function
        function updateSpeedometer() {
            const now = new Date();
            const elapsed = (now - fastStart) / (1000 * 60); // in minutes
            const elapsedHours = elapsed / 60;

            // Update needle rotation (0 hours = 0¬∞, 72 hours = 360¬∞)
            const needleRotation = (elapsedHours / 72) * 360;
            document.getElementById('needle').setAttribute('transform', `rotate(${needleRotation} 180 160)`);

            // Update hours display
            document.getElementById('hoursDisplay').textContent = elapsedHours.toFixed(2) + ' / 72 HOURS';

            // Get current stage and update phase label
            const stage = getStageInfo(Math.floor(elapsedHours));
            document.getElementById('phaseLabel').textContent = stage.name.toUpperCase();

            // Update hunger display from slider
            const hunger = parseFloat(document.getElementById('hungerSlider').value);
            document.getElementById('hungerDisplay').textContent = hunger + '/5';

            // Update clarity display
            const clarity = parseFloat(document.getElementById('claritySlider').value);
            const energy = Math.round(clarity * 1.25); // Convert clarity to energy emoji count
            const energyBar = '‚ö°'.repeat(Math.min(energy, 5));
            document.getElementById('clarityDisplay').textContent = `Clarity: ${clarity}/5 | Energy: ${energyBar}`;
        }

        // Measurement functions
        function updateMeasurementInputs() {
            const inputsDiv = document.getElementById('measurementInputs');
            const selectedParts = [];
            
            Object.keys(bodyParts).forEach(key => {
                const checkbox = document.getElementById('measure_' + key);
                if (checkbox && checkbox.checked) {
                    selectedParts.push(key);
                }
            });

            if (selectedParts.length === 0) {
                inputsDiv.innerHTML = '<p style="color: var(--color-text-secondary); font-size: 13px;">Select body parts above to enter values</p>';
                return;
            }

            inputsDiv.innerHTML = selectedParts.map(part => `
                <div class="form-group">
                    <label>${bodyParts[part].icon} ${bodyParts[part].label} (${bodyParts[part].unit})</label>
                    <input type="number" id="input_${part}" step="0.1" placeholder="Enter ${bodyParts[part].label.toLowerCase()}">
                </div>
            `).join('');
        }

        function addMeasurement() {
            const date = document.getElementById('measurementDate').value;
            const notes = document.getElementById('measurementNotes').value;
            
            if (!date) {
                alert('Please select a measurement date');
                return;
            }

            const measurements = {};
            let hasData = false;

            Object.keys(bodyParts).forEach(key => {
                const input = document.getElementById('input_' + key);
                if (input && input.value) {
                    measurements[key] = parseFloat(input.value);
                    hasData = true;
                }
            });

            if (!hasData) {
                alert('Please enter at least one measurement');
                return;
            }

            const entry = {
                date,
                measurements,
                notes,
                timestamp: new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })
            };

            measurementEntries.push(entry);

            // Clear form
            document.getElementById('measurementDate').value = '';
            document.getElementById('measurementNotes').value = '';
            Object.keys(bodyParts).forEach(key => {
                const checkbox = document.getElementById('measure_' + key);
                const input = document.getElementById('input_' + key);
                if (checkbox) checkbox.checked = false;
                if (input) input.value = '';
            });
            updateMeasurementInputs();

            renderMeasurementHistory();
            alert('‚úÖ Measurements saved!');
        }

        function renderMeasurementHistory() {
            const historyDiv = document.getElementById('measurementHistory');
            const noMeasurements = document.getElementById('noMeasurements');

            if (measurementEntries.length === 0) {
                historyDiv.innerHTML = '';
                noMeasurements.style.display = 'block';
                return;
            }

            noMeasurements.style.display = 'none';
            historyDiv.innerHTML = measurementEntries.map((entry, idx) => {
                const firstEntry = measurementEntries[0];
                const isFirstEntry = idx === 0;
                
                return `
                    <div class="log-entry">
                        <div class="log-time">${isFirstEntry ? 'üìå BASELINE' : `Entry #${idx}`} - ${entry.date}</div>
                        <div class="log-details" style="grid-template-columns: 1fr;">
                            ${Object.keys(entry.measurements).map(key => {
                                const value = entry.measurements[key];
                                const baseline = firstEntry.measurements[key];
                                const change = baseline ? (value - baseline).toFixed(1) : 0;
                                const changeText = change > 0 ? `‚Üë +${change}` : change < 0 ? `‚Üì ${change}` : '‚Üí No change';
                                const changeColor = change < 0 ? '#4CAF50' : change > 0 ? '#FF6B6B' : '#FFC107';
                                
                                return `
                                    <div class="log-detail-item" style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                        <span class="log-label">${bodyParts[key].icon} ${bodyParts[key].label}</span>
                                        <div style="text-align: right;">
                                            <span class="log-value">${value} ${bodyParts[key].unit}</span>
                                            <span style="display: block; font-size: 11px; color: ${changeColor}; margin-top: 2px;">${isFirstEntry ? 'Baseline' : changeText}</span>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        ${entry.notes ? `<div class="log-craving" style="background: #f0f0f0; color: #333;">üìù Notes: ${entry.notes}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Initialize measurement date
        const todayDate = new Date().toISOString().split('T')[0];
        document.getElementById('measurementDate').value = todayDate;

        // Add event listeners for checkboxes
        Object.keys(bodyParts).forEach(key => {
            const checkbox = document.getElementById('measure_' + key);
            if (checkbox) {
                checkbox.addEventListener('change', updateMeasurementInputs);
            }
        });

        // Initialize chart date range
        document.getElementById('chartStartDate').value = new Date(new Date().setDate(new Date().getDate() - 30)).toISOString().split('T')[0];
        document.getElementById('chartEndDate').value = todayDate;

        // Notification variables
        let notificationInterval = null;
        let notificationsEnabled = false;

        // Export to CSV
        function exportToCSV() {
            const allData = {
                userData: {
                    name: 'Sam',
                    weight: '94 kg',
                    height: '161 cm',
                    age: 40,
                    exportDate: new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })
                },
                logEntries: logEntries,
                exerciseEntries: exerciseEntries,
                measurementEntries: measurementEntries,
                snackLog: snackLog
            };

            let csv = 'FastTrack Pro - Data Export\n';
            csv += `Exported: ${allData.userData.exportDate}\n\n`;

            // User data
            csv += 'USER INFO\n';
            csv += `Name,Weight,Height,Age\n`;
            csv += `${allData.userData.name},${allData.userData.weight},${allData.userData.height} cm,${allData.userData.age}\n\n`;

            // Log entries
            csv += 'FASTING LOG ENTRIES\n';
            csv += 'Time,Hunger,Clarity,Water (L),Salt,Cravings,Notes,Timestamp\n';
            logEntries.forEach(entry => {
                csv += `"${entry.time}","${entry.hunger}","${entry.clarity}","${entry.water}","${entry.salt}","${entry.craving.replace(/"/g, '""')}","${entry.notes.replace(/"/g, '""')}","${entry.timestamp}"\n`;
            });
            csv += '\n';

            // Exercise entries
            csv += 'EXERCISE LOG ENTRIES\n';
            csv += 'Time,Activity,Duration (min),Intensity,Energy,Calories Burned,Notes,Timestamp\n';
            exerciseEntries.forEach(entry => {
                csv += `"${entry.time}","${entry.type}","${entry.duration}","${entry.intensity}","${entry.energy}","${entry.calories}","${entry.notes.replace(/"/g, '""')}","${entry.timestamp}"\n`;
            });
            csv += '\n';

            // Measurements
            csv += 'BODY MEASUREMENTS\n';
            csv += 'Date,Weight (kg),Chest (cm),Waist (cm),Hips (cm),Thigh (cm),Arm (cm),Neck (cm),Forearm (cm),Notes,Timestamp\n';
            measurementEntries.forEach(entry => {
                csv += `"${entry.date}","${entry.measurements.weight || ''}","${entry.measurements.chest || ''}","${entry.measurements.waist || ''}","${entry.measurements.hips || ''}","${entry.measurements.thigh || ''}","${entry.measurements.arm || ''}","${entry.measurements.neck || ''}","${entry.measurements.forearm || ''}","${entry.notes.replace(/"/g, '""')}","${entry.timestamp}"\n`;
            });

            // Download
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `FastTrack-Export-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);

            alert('‚úÖ Data exported to CSV!');
        }

        // Export to Email (simulated)
        function exportToEmail() {
            const email = prompt('üìß Enter your email address:', 'sam@example.com');
            if (!email) return;

            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                alert('‚ùå Invalid email address');
                return;
            }

            const emailData = {
                to: email,
                subject: `FastTrack Pro Export - ${new Date().toDateString()}`,
                body: `Attached is your fasting data export from FastTrack Pro.\n\nTotal Log Entries: ${logEntries.length}\nTotal Exercises: ${exerciseEntries.length}\nTotal Measurements: ${measurementEntries.length}`,
                attachments: [
                    { filename: `FastTrack-Export-${new Date().toISOString().split('T')[0]}.csv`, data: generateCSVData() }
                ]
            };

            console.log('Email data prepared:', emailData);
            alert(`‚úÖ Email prepared for: ${email}\n\n(In production, this would send via email service)\n\nTip: Download CSV above to share manually.`);
        }

        function generateCSVData() {
            let csv = 'FastTrack Pro - Data Export\n';
            csv += `Exported: ${new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })}\n\n`;
            csv += 'LOG ENTRIES: ' + logEntries.length + '\n';
            csv += 'EXERCISES: ' + exerciseEntries.length + '\n';
            csv += 'MEASUREMENTS: ' + measurementEntries.length + '\n';
            return csv;
        }

        // Import from CSV
        function importFromCSV() {
            const file = document.getElementById('importFile').files[0];
            if (!file) {
                alert('Please select a file');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const lines = content.split('\n');
                    
                    let section = '';
                    let imported = { logs: 0, exercises: 0, measurements: 0 };

                    for (let i = 2; i < lines.length; i++) {
                        const line = lines[i].trim();
                        
                        if (line === 'FASTING LOG ENTRIES') {
                            section = 'logs';
                            i += 1; // Skip header
                            continue;
                        } else if (line === 'EXERCISE LOG ENTRIES') {
                            section = 'exercises';
                            i += 1;
                            continue;
                        } else if (line === 'BODY MEASUREMENTS') {
                            section = 'measurements';
                            i += 1;
                            continue;
                        }

                        if (!line || line.startsWith('FastTrack') || line.startsWith('Exported') || line.startsWith('USER INFO') || line.startsWith('Date,')) continue;

                        if (section === 'logs' && line) {
                            // Simple CSV parse (handles quoted fields)
                            const parts = line.match(/"([^"]*)"|[^,]+/g) || [];
                            if (parts.length >= 7) {
                                logEntries.push({
                                    time: parts[0].replace(/"/g, ''),
                                    hunger: parts[1].replace(/"/g, ''),
                                    clarity: parts[2].replace(/"/g, ''),
                                    water: parts[3].replace(/"/g, ''),
                                    salt: parts[4].replace(/"/g, ''),
                                    craving: parts[5].replace(/"/g, ''),
                                    notes: parts[6].replace(/"/g, ''),
                                    timestamp: parts[7]?.replace(/"/g, '') || new Date().toLocaleString()
                                });
                                imported.logs++;
                            }
                        } else if (section === 'exercises' && line) {
                            const parts = line.match(/"([^"]*)"|[^,]+/g) || [];
                            if (parts.length >= 7) {
                                exerciseEntries.push({
                                    time: parts[0].replace(/"/g, ''),
                                    type: parts[1].replace(/"/g, ''),
                                    duration: parseFloat(parts[2]) || 0,
                                    intensity: parts[3].replace(/"/g, ''),
                                    energy: parts[4].replace(/"/g, ''),
                                    calories: parseFloat(parts[5]) || 0,
                                    notes: parts[6].replace(/"/g, ''),
                                    timestamp: parts[7]?.replace(/"/g, '') || new Date().toLocaleString()
                                });
                                imported.exercises++;
                            }
                        } else if (section === 'measurements' && line) {
                            const parts = line.match(/"([^"]*)"|[^,]+/g) || [];
                            if (parts.length >= 2) {
                                measurementEntries.push({
                                    date: parts[0].replace(/"/g, ''),
                                    measurements: {
                                        weight: parts[1] ? parseFloat(parts[1]) : null,
                                        chest: parts[2] ? parseFloat(parts[2]) : null,
                                        waist: parts[3] ? parseFloat(parts[3]) : null,
                                        hips: parts[4] ? parseFloat(parts[4]) : null,
                                        thigh: parts[5] ? parseFloat(parts[5]) : null,
                                        arm: parts[6] ? parseFloat(parts[6]) : null,
                                        neck: parts[7] ? parseFloat(parts[7]) : null,
                                        forearm: parts[8] ? parseFloat(parts[8]) : null
                                    },
                                    notes: parts[9]?.replace(/"/g, '') || '',
                                    timestamp: parts[10]?.replace(/"/g, '') || new Date().toLocaleString()
                                });
                                imported.measurements++;
                            }
                        }
                    }

                    renderHistory();
                    renderMeasurementHistory();
                    renderExerciseHistory();
                    updateExerciseSummary();

                    alert(`‚úÖ Data imported successfully!\n\nLog Entries: ${imported.logs}\nExercises: ${imported.exercises}\nMeasurements: ${imported.measurements}`);
                    document.getElementById('importFile').value = '';
                } catch (error) {
                    alert('‚ùå Error importing file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Weight Chart
        function generateWeightChart() {
            const startDate = new Date(document.getElementById('chartStartDate').value);
            const endDate = new Date(document.getElementById('chartEndDate').value);
            
            const filteredMeasurements = measurementEntries.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate >= startDate && entryDate <= endDate;
            }).sort((a, b) => new Date(a.date) - new Date(b.date));

            if (filteredMeasurements.length === 0) {
                document.getElementById('weightChartContainer').style.display = 'none';
                document.getElementById('noChartData').style.display = 'block';
                return;
            }

            const labels = filteredMeasurements.map(m => m.date);
            const data = filteredMeasurements.map(m => m.measurements.weight).filter(w => w !== null && w !== undefined);

            if (data.length === 0) {
                document.getElementById('weightChartContainer').style.display = 'none';
                document.getElementById('noChartData').style.display = 'block';
                return;
            }

            document.getElementById('noChartData').style.display = 'none';
            document.getElementById('weightChartContainer').style.display = 'block';

            const ctx = document.getElementById('weightChart').getContext('2d');
            
            if (window.weightChartInstance) {
                window.weightChartInstance.destroy();
            }

            const minWeight = Math.min(...data);
            const maxWeight = Math.max(...data);
            const yMin = Math.floor(minWeight - 2);
            const yMax = Math.ceil(maxWeight + 2);

            window.weightChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Weight (kg)',
                        data: data,
                        borderColor: '#208091',
                        backgroundColor: 'rgba(32, 128, 145, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: '#208091',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            labels: { font: { size: 12 }, color: '#1a1a1a' }
                        },
                        title: {
                            display: true,
                            text: 'Weight Progress Over Time',
                            font: { size: 14, weight: 'bold' },
                            color: '#208091'
                        }
                    },
                    scales: {
                        y: {
                            min: yMin,
                            max: yMax,
                            ticks: { stepSize: 1, font: { size: 11 } },
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            title: { display: true, text: 'Weight (kg)', font: { size: 12 } }
                        },
                        x: {
                            ticks: { font: { size: 11 } },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        // Notification system
        function enableNotifications() {
            if (!('Notification' in window)) {
                alert('‚ö†Ô∏è Notifications not supported in this browser');
                return;
            }

            if (Notification.permission === 'denied') {
                alert('‚ö†Ô∏è Notifications are blocked. Enable in browser settings.');
                return;
            }

            if (Notification.permission === 'granted') {
                startNotifications();
            } else {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        startNotifications();
                    }
                });
            }
        }

        function startNotifications() {
            const frequency = parseInt(document.getElementById('reminderFrequency').value);
            const customTime = parseInt(document.getElementById('customReminderTime').value) || frequency;
            const reminderWater = document.getElementById('reminderWater').checked;
            const reminderSalt = document.getElementById('reminderSalt').checked;
            const interval = document.getElementById('reminderFrequency').value === 'custom' ? customTime * 60000 : frequency * 60000;

            notificationsEnabled = true;
            let notificationCount = 0;

            clearInterval(notificationInterval);

            notificationInterval = setInterval(() => {
                if (reminderWater && notificationCount % 2 === 0) {
                    new Notification('üíß Hydration Reminder', {
                        body: 'Time to drink water! Stay hydrated during your fast.',
                        icon: 'üíß',
                        tag: 'hydration'
                    });
                }
                if (reminderSalt && notificationCount % 2 === 1) {
                    new Notification('üßÇ Electrolyte Reminder', {
                        body: 'Consider some salt/electrolytes. Add pinch of salt to water.',
                        icon: 'üßÇ',
                        tag: 'salt'
                    });
                }
                notificationCount++;
            }, interval);

            alert(`‚úÖ Notifications enabled!\nReminder every ${document.getElementById('reminderFrequency').value === 'custom' ? customTime + ' minutes' : frequency + ' minute(s)'}`);
        }

        function disableNotifications() {
            if (notificationInterval) {
                clearInterval(notificationInterval);
                notificationInterval = null;
                notificationsEnabled = false;
                alert('üîá Notifications disabled');
            }
        }

        // Handle custom reminder time visibility
        document.getElementById('reminderFrequency').addEventListener('change', function() {
            const customGroup = document.getElementById('customTimeGroup');
            customGroup.style.display = this.value === 'custom' ? 'block' : 'none';
        });

        // Load Chart.js library
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
        document.head.appendChild(script);

        // Initialize
        document.getElementById('bmrValue').textContent = bmr.toLocaleString() + ' kcal';
        updateFastingTime();
        updateHunger();
        updateIntensity();
        updateExerciseSummary();
        updateSpeedometer();
        setInterval(updateFastingTime, 60000); // Update every minute
        setInterval(updateSpeedometer, 60000); // Update speedometer every minute
    </script>
</body>
</html>
